"""crypto_check"""

# imports
import os
import yara
from utils import search_files_in_directory, in_string
# find files with name ending in .yar in the current directory and sub directories
# and add them to the list of rules

RULES_PATH = search_files_in_directory("yar",str(os.getcwd()))
try:
    #Read files
    peid_rules = yara.compile(list(filter(lambda x: in_string("peid", x) ,RULES_PATH))[0])
    packer_rules = yara.compile(list(filter(lambda x: in_string("packer", x) ,RULES_PATH))[0])
    crypto_rules = yara.compile(list(filter(lambda x: in_string("crypto_signatures", x) ,RULES_PATH))[0])
except Exception:
    print("error", Exception)

#Now we will try to find out if yara rules match with the exe
#file, if so that means that yara has detected a packer or a cryptor
#first we try to detect cryptors
def check_exe_path(
    exe_file_path:str= str(os.getcwd())+"/V_3"):
    """
    check the folder for cryptors

    Args:
        exe_file_path: the path to the exe file
    """
    try:
        #the function match will return the list of detected cryptors
        matches = crypto_rules.match(exe_file_path)
        if matches:
            print('Cryptors detected')
            print(matches)
    except Exception:
        #I always add this exception thing, because I don't know what could happen
        print('No Cryptors detected')
    #detect packers

    try:
        matches = packer_rules.match(exe_file_path)
        if matches:
            print('packers detected')
            print(matches)
    except Exception:
        print('no packer detected')
