"""crypto_check"""

# imports
import yara
import os

#Path to the folder containing downloaded files in the first part
try:
    rules_path = str(os.getcwd())+ "\\database\\rules\\"
    #Read files
    peid_rules = yara.compile(rules_path + 'peid.yar')
    packer_rules = yara.compile(rules_path + 'packer.yar')
    crypto_rules = yara.compile(rules_path + 'crypto_signatures.yar')
except Exception:
    rules_path = str(os.getcwd())+ "\\V_3" + "\\database\\rules\\"
    #Read files
    peid_rules = yara.compile(rules_path + 'peid.yar')
    packer_rules = yara.compile(rules_path + 'packer.yar')
    crypto_rules = yara.compile(rules_path + 'crypto_signatures.yar')

#Now we will try to find out if yara rules match with the exe
#file, if so that means that yara has detected a packer or a cryptor
#first we try to detect cryptors
def check_exe_path(my_dir:str=str(os.getcwd())
        ,exe_file_path:str="D:\\projects\\malware\\Malware_Behavioural_Based\\V_3\\")->str:
    try:
        #the function match will return the list of detected cryptors
        matches = crypto_rules.match(exe_file_path)
        if matches:
            print('Cryptors detected')
            print(matches)
    except:
        #I always add this exception thing, because I don't know what could happen
        print('no Cryptors detected')    
    #detect packers

    try:
        matches = packer_rules.match(exe_file_path)
        if matches:
            print('packers detected')
            print(matches)
    except:
        print('no packer detected')
